<!DOCTYPE html>
<html>
<head>
  <title>Cilaos le Jeu</title>
  <meta charset="UTF-8">
  <style>
  html, body {
    height: 100%;
    margin: 0;
  }

  body {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  canvas {
    border: 1px solid black;
  }
  </style>
</head>
<body>
<canvas width="320" height="480" id="game"></canvas>
<script>
const canvas = document.getElementById('game');
const context = canvas.getContext('2d');

let end = false;
let menu = false;

let turn = 0;
let phase = 0;

let cards = [
  {type:0, decription:"", pt:1, ability:0},
  {type:0, decription:"", pt:2, ability:-1},
  {type:0, decription:"", pt:3, ability:-1},
  {type:0, decription:"", pt:4, ability:-1},
  {type:0, decription:"", pt:5, ability:-1},
  {type:1, decription:"", pt:1, ability:1},
  {type:1, decription:"", pt:2, ability:-1},
  {type:1, decription:"", pt:3, ability:-1},
  {type:1, decription:"", pt:4, ability:-1},
  {type:1, decription:"", pt:5, ability:-1},
  {type:2, decription:"", pt:1, ability:2},
  {type:2, decription:"", pt:2, ability:-1},
  {type:2, decription:"", pt:3, ability:-1},
  {type:2, decription:"", pt:4, ability:-1},
  {type:2, decription:"", pt:5, ability:-1},
  {type:3, decription:"", pt:1, ability:3},
  {type:3, decription:"", pt:2, ability:-1},
  {type:3, decription:"", pt:3, ability:-1},
  {type:3, decription:"", pt:4, ability:-1},
  {type:3, decription:"", pt:5, ability:-1}
];

let player = {pt:0, hand:[], board:[]};
let opponent = {pt:0, hand:[], board:[]};

for (let i = 0; i < 9; i++) {
  let a = Math.floor(Math.random() * 20);
  let b = Math.floor(Math.random() * 20);
  player.hand.push(cards[a]);
  opponent.hand.push(cards[a]);
}

let image = new Image();
image.src = "image.png"
let backgroundImage = new Image();
backgroundImage.src = "background.png"

context.fillStyle = 'red';

function drawCard(j) {
  let a = Math.floor(Math.random() * 20);
  j.hand.push(cards[a]);
}

function doublePoint(j, c) {
  let nb = 0;

  j.board.forEach(function(bc) {
    if (bc.type == j.hand[c].type)
      nb++;
  });
  if (nb >= 3)
    j.pt *= 2;
}

function plusThree(j) {
  let nb = j.board.length - 2;

  if (nb >= 0)
    j.board[nb].pt += 3;
  j.pt += 3;
}

function nullifie(j) {
  let nb = j.board.length - 2;

  if (nb >= 0)
    j.board[nb].type = -1;
}

function playCard(j, op, c) {
  let pt = j.hand[c].pt;

  for (let i = 0; i < j.board.length; i++) {
    if (j.board[i].type == j.hand[c].type) {
      pt *= 2;
      break;
    }
  }
  j.pt += pt;
  j.board.push(j.hand[c]);
  if (j.hand[c].ability != -1) {
    let a = j.hand[c].ability;
    if (a == 0)
      doublePoint(j, c);
    else if (a == 1)
      plusThree(j);
    else if (a == 2)
      op.pt = (op.pt < 4) ? 0 : op.pt - 4;
    else
      nullifie(op);
  }
  j.hand.pop(c);
}

function greed(j) {
  let res = 0;
  for (let i = 1; i < j.hand.length; i++)
    if (j.hand[i].pt > j.hand[res].pt)
      res = i;
  return res;
}

function loop() {
  requestAnimationFrame(loop);
  context.clearRect(0,0,canvas.width,canvas.height);
  context.drawImage(backgroundImage, 0, 0, 320, 480, 0, 0, canvas.width, canvas.height);

  if (menu) {
    context.textAlign = "center";
    context.font = "40px Arial";
    context.fillText("Tap to play", canvas.width / 2, canvas.height / 2);
  } else if (!end) {
      // context.drawImage(image, tile.valueX * imW + frameSize * currentFrame, tile.valueY * imH, imW, imH, tile.x, tile.y, selectionW, selectionH);
      if (turn == 5)
        end = true;
  } else {
    context.textAlign = "center";
    context.font = "40px Arial";
    if (player.pt > ia.pt)
      context.fillText("Victoire !", canvas.width / 2, canvas.height / 2 - 40);
    else if (player.pt < ia.pt)
      context.fillText("DÃ©faite...", canvas.width / 2, canvas.height / 2 - 40);
    else
      context.fillText("Match nul.", canvas.width / 2, canvas.height / 2 - 40);
    context.font = "20px Arial";
    context.fillText("tap to restart", canvas.width / 2, canvas.height - 10);
  }
}

// setInterval(increment, 1000);

document.addEventListener('click', function(e) {
  let relativeX = e.x - canvas.offsetLeft;
  let relativeY = e.y - canvas.offsetTop;

  if (!end && !menu) {
    return;
  } else if (menu) {
    menu = false;
    return;
  } else {
    end = false;
    menu = true;
  }
 });

requestAnimationFrame(loop);
</script>
</body>
</html>